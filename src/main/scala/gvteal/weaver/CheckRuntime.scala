package gvteal.weaver
import scala.io.Source
import fastparse.Parsed.{Failure, Success}
import gvteal.parser._
import gvteal.analyzer._
import gvteal.transformer.{DependencyTransformer, IR, IRPrinter}
object CheckRuntime {
  val name = "runtime"
  private lazy val header: ResolvedProgram = {
    

    val resolved = ResolvedProgram(List(ResolvedMethodDeclaration(MethodDefinition(Identifier("initOwnedFields",SourceSpan(SourcePosition(21,14,319),SourcePosition(21,29,334))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(21,1,306),SourcePosition(21,12,317))),SourceSpan(SourcePosition(21,1,306),SourcePosition(21,12,317))),SourceSpan(SourcePosition(21,1,306),SourcePosition(21,13,318))),List(MemberDefinition(Identifier("instanceCounter",SourceSpan(SourcePosition(21,36,341),SourcePosition(21,51,356))),PointerType(NamedType(Identifier("int",SourceSpan(SourcePosition(21,30,335),SourcePosition(21,33,338))),SourceSpan(SourcePosition(21,30,335),SourcePosition(21,33,338))),SourceSpan(SourcePosition(21,30,335),SourcePosition(21,35,340))),SourceSpan(SourcePosition(21,30,335),SourcePosition(21,51,356)))),None,List(),SourceSpan(SourcePosition(21,1,306),SourcePosition(21,53,358))),ResolvedPointer(ResolvedStructType("OwnedFields")),"initOwnedFields",List(ResolvedVariable(MemberDefinition(Identifier("instanceCounter",SourceSpan(SourcePosition(21,36,341),SourcePosition(21,51,356))),PointerType(NamedType(Identifier("int",SourceSpan(SourcePosition(21,30,335),SourcePosition(21,33,338))),SourceSpan(SourcePosition(21,30,335),SourcePosition(21,33,338))),SourceSpan(SourcePosition(21,30,335),SourcePosition(21,35,340))),SourceSpan(SourcePosition(21,30,335),SourcePosition(21,51,356))),"instanceCounter",ResolvedPointer(IntType))),None,None,false), ResolvedMethodDeclaration(MethodDefinition(Identifier("addStructAcc",SourceSpan(SourcePosition(22,5,363),SourcePosition(22,17,375))),NamedType(Identifier("int",SourceSpan(SourcePosition(22,1,359),SourcePosition(22,4,362))),SourceSpan(SourcePosition(22,1,359),SourcePosition(22,4,362))),List(MemberDefinition(Identifier("fields",SourceSpan(SourcePosition(22,32,390),SourcePosition(22,38,396))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(22,18,376),SourcePosition(22,29,387))),SourceSpan(SourcePosition(22,18,376),SourcePosition(22,29,387))),SourceSpan(SourcePosition(22,18,376),SourcePosition(22,31,389))),SourceSpan(SourcePosition(22,18,376),SourcePosition(22,38,396))), MemberDefinition(Identifier("numFields",SourceSpan(SourcePosition(22,44,402),SourcePosition(22,53,411))),NamedType(Identifier("int",SourceSpan(SourcePosition(22,40,398),SourcePosition(22,43,401))),SourceSpan(SourcePosition(22,40,398),SourcePosition(22,43,401))),SourceSpan(SourcePosition(22,40,398),SourcePosition(22,53,411)))),None,List(),SourceSpan(SourcePosition(22,1,359),SourcePosition(22,55,413))),IntType,"addStructAcc",List(ResolvedVariable(MemberDefinition(Identifier("fields",SourceSpan(SourcePosition(22,32,390),SourcePosition(22,38,396))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(22,18,376),SourcePosition(22,29,387))),SourceSpan(SourcePosition(22,18,376),SourcePosition(22,29,387))),SourceSpan(SourcePosition(22,18,376),SourcePosition(22,31,389))),SourceSpan(SourcePosition(22,18,376),SourcePosition(22,38,396))),"fields",ResolvedPointer(ResolvedStructType("OwnedFields"))), ResolvedVariable(MemberDefinition(Identifier("numFields",SourceSpan(SourcePosition(22,44,402),SourcePosition(22,53,411))),NamedType(Identifier("int",SourceSpan(SourcePosition(22,40,398),SourcePosition(22,43,401))),SourceSpan(SourcePosition(22,40,398),SourcePosition(22,43,401))),SourceSpan(SourcePosition(22,40,398),SourcePosition(22,53,411))),"numFields",IntType)),None,None,false), ResolvedMethodDeclaration(MethodDefinition(Identifier("addAcc",SourceSpan(SourcePosition(23,6,419),SourcePosition(23,12,425))),NamedType(Identifier("void",SourceSpan(SourcePosition(23,1,414),SourcePosition(23,5,418))),SourceSpan(SourcePosition(23,1,414),SourcePosition(23,5,418))),List(MemberDefinition(Identifier("fields",SourceSpan(SourcePosition(23,27,440),SourcePosition(23,33,446))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(23,13,426),SourcePosition(23,24,437))),SourceSpan(SourcePosition(23,13,426),SourcePosition(23,24,437))),SourceSpan(SourcePosition(23,13,426),SourcePosition(23,26,439))),SourceSpan(SourcePosition(23,13,426),SourcePosition(23,33,446))), MemberDefinition(Identifier("_id",SourceSpan(SourcePosition(23,39,452),SourcePosition(23,42,455))),NamedType(Identifier("int",SourceSpan(SourcePosition(23,35,448),SourcePosition(23,38,451))),SourceSpan(SourcePosition(23,35,448),SourcePosition(23,38,451))),SourceSpan(SourcePosition(23,35,448),SourcePosition(23,42,455))), MemberDefinition(Identifier("numFields",SourceSpan(SourcePosition(23,48,461),SourcePosition(23,57,470))),NamedType(Identifier("int",SourceSpan(SourcePosition(23,44,457),SourcePosition(23,47,460))),SourceSpan(SourcePosition(23,44,457),SourcePosition(23,47,460))),SourceSpan(SourcePosition(23,44,457),SourcePosition(23,57,470))), MemberDefinition(Identifier("fieldIndex",SourceSpan(SourcePosition(23,63,476),SourcePosition(23,73,486))),NamedType(Identifier("int",SourceSpan(SourcePosition(23,59,472),SourcePosition(23,62,475))),SourceSpan(SourcePosition(23,59,472),SourcePosition(23,62,475))),SourceSpan(SourcePosition(23,59,472),SourcePosition(23,73,486)))),None,List(),SourceSpan(SourcePosition(23,1,414),SourcePosition(23,75,488))),VoidType,"addAcc",List(ResolvedVariable(MemberDefinition(Identifier("fields",SourceSpan(SourcePosition(23,27,440),SourcePosition(23,33,446))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(23,13,426),SourcePosition(23,24,437))),SourceSpan(SourcePosition(23,13,426),SourcePosition(23,24,437))),SourceSpan(SourcePosition(23,13,426),SourcePosition(23,26,439))),SourceSpan(SourcePosition(23,13,426),SourcePosition(23,33,446))),"fields",ResolvedPointer(ResolvedStructType("OwnedFields"))), ResolvedVariable(MemberDefinition(Identifier("_id",SourceSpan(SourcePosition(23,39,452),SourcePosition(23,42,455))),NamedType(Identifier("int",SourceSpan(SourcePosition(23,35,448),SourcePosition(23,38,451))),SourceSpan(SourcePosition(23,35,448),SourcePosition(23,38,451))),SourceSpan(SourcePosition(23,35,448),SourcePosition(23,42,455))),"_id",IntType), ResolvedVariable(MemberDefinition(Identifier("numFields",SourceSpan(SourcePosition(23,48,461),SourcePosition(23,57,470))),NamedType(Identifier("int",SourceSpan(SourcePosition(23,44,457),SourcePosition(23,47,460))),SourceSpan(SourcePosition(23,44,457),SourcePosition(23,47,460))),SourceSpan(SourcePosition(23,44,457),SourcePosition(23,57,470))),"numFields",IntType), ResolvedVariable(MemberDefinition(Identifier("fieldIndex",SourceSpan(SourcePosition(23,63,476),SourcePosition(23,73,486))),NamedType(Identifier("int",SourceSpan(SourcePosition(23,59,472),SourcePosition(23,62,475))),SourceSpan(SourcePosition(23,59,472),SourcePosition(23,62,475))),SourceSpan(SourcePosition(23,59,472),SourcePosition(23,73,486))),"fieldIndex",IntType)),None,None,false), ResolvedMethodDeclaration(MethodDefinition(Identifier("loseAcc",SourceSpan(SourcePosition(24,6,494),SourcePosition(24,13,501))),NamedType(Identifier("void",SourceSpan(SourcePosition(24,1,489),SourcePosition(24,5,493))),SourceSpan(SourcePosition(24,1,489),SourcePosition(24,5,493))),List(MemberDefinition(Identifier("fields",SourceSpan(SourcePosition(24,28,516),SourcePosition(24,34,522))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(24,14,502),SourcePosition(24,25,513))),SourceSpan(SourcePosition(24,14,502),SourcePosition(24,25,513))),SourceSpan(SourcePosition(24,14,502),SourcePosition(24,27,515))),SourceSpan(SourcePosition(24,14,502),SourcePosition(24,34,522))), MemberDefinition(Identifier("_id",SourceSpan(SourcePosition(24,40,528),SourcePosition(24,43,531))),NamedType(Identifier("int",SourceSpan(SourcePosition(24,36,524),SourcePosition(24,39,527))),SourceSpan(SourcePosition(24,36,524),SourcePosition(24,39,527))),SourceSpan(SourcePosition(24,36,524),SourcePosition(24,43,531))), MemberDefinition(Identifier("fieldIndex",SourceSpan(SourcePosition(24,49,537),SourcePosition(24,59,547))),NamedType(Identifier("int",SourceSpan(SourcePosition(24,45,533),SourcePosition(24,48,536))),SourceSpan(SourcePosition(24,45,533),SourcePosition(24,48,536))),SourceSpan(SourcePosition(24,45,533),SourcePosition(24,59,547)))),None,List(),SourceSpan(SourcePosition(24,1,489),SourcePosition(24,61,549))),VoidType,"loseAcc",List(ResolvedVariable(MemberDefinition(Identifier("fields",SourceSpan(SourcePosition(24,28,516),SourcePosition(24,34,522))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(24,14,502),SourcePosition(24,25,513))),SourceSpan(SourcePosition(24,14,502),SourcePosition(24,25,513))),SourceSpan(SourcePosition(24,14,502),SourcePosition(24,27,515))),SourceSpan(SourcePosition(24,14,502),SourcePosition(24,34,522))),"fields",ResolvedPointer(ResolvedStructType("OwnedFields"))), ResolvedVariable(MemberDefinition(Identifier("_id",SourceSpan(SourcePosition(24,40,528),SourcePosition(24,43,531))),NamedType(Identifier("int",SourceSpan(SourcePosition(24,36,524),SourcePosition(24,39,527))),SourceSpan(SourcePosition(24,36,524),SourcePosition(24,39,527))),SourceSpan(SourcePosition(24,36,524),SourcePosition(24,43,531))),"_id",IntType), ResolvedVariable(MemberDefinition(Identifier("fieldIndex",SourceSpan(SourcePosition(24,49,537),SourcePosition(24,59,547))),NamedType(Identifier("int",SourceSpan(SourcePosition(24,45,533),SourcePosition(24,48,536))),SourceSpan(SourcePosition(24,45,533),SourcePosition(24,48,536))),SourceSpan(SourcePosition(24,45,533),SourcePosition(24,59,547))),"fieldIndex",IntType)),None,None,false), ResolvedMethodDeclaration(MethodDefinition(Identifier("join",SourceSpan(SourcePosition(25,6,555),SourcePosition(25,10,559))),NamedType(Identifier("void",SourceSpan(SourcePosition(25,1,550),SourcePosition(25,5,554))),SourceSpan(SourcePosition(25,1,550),SourcePosition(25,5,554))),List(MemberDefinition(Identifier("target",SourceSpan(SourcePosition(25,24,573),SourcePosition(25,30,579))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(25,11,560),SourcePosition(25,22,571))),SourceSpan(SourcePosition(25,11,560),SourcePosition(25,22,571))),SourceSpan(SourcePosition(25,11,560),SourcePosition(25,23,572))),SourceSpan(SourcePosition(25,11,560),SourcePosition(25,30,579))), MemberDefinition(Identifier("source",SourceSpan(SourcePosition(25,45,594),SourcePosition(25,51,600))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(25,32,581),SourcePosition(25,43,592))),SourceSpan(SourcePosition(25,32,581),SourcePosition(25,43,592))),SourceSpan(SourcePosition(25,32,581),SourcePosition(25,44,593))),SourceSpan(SourcePosition(25,32,581),SourcePosition(25,51,600)))),None,List(),SourceSpan(SourcePosition(25,1,550),SourcePosition(25,53,602))),VoidType,"join",List(ResolvedVariable(MemberDefinition(Identifier("target",SourceSpan(SourcePosition(25,24,573),SourcePosition(25,30,579))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(25,11,560),SourcePosition(25,22,571))),SourceSpan(SourcePosition(25,11,560),SourcePosition(25,22,571))),SourceSpan(SourcePosition(25,11,560),SourcePosition(25,23,572))),SourceSpan(SourcePosition(25,11,560),SourcePosition(25,30,579))),"target",ResolvedPointer(ResolvedStructType("OwnedFields"))), ResolvedVariable(MemberDefinition(Identifier("source",SourceSpan(SourcePosition(25,45,594),SourcePosition(25,51,600))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(25,32,581),SourcePosition(25,43,592))),SourceSpan(SourcePosition(25,32,581),SourcePosition(25,43,592))),SourceSpan(SourcePosition(25,32,581),SourcePosition(25,44,593))),SourceSpan(SourcePosition(25,32,581),SourcePosition(25,51,600))),"source",ResolvedPointer(ResolvedStructType("OwnedFields")))),None,None,false), ResolvedMethodDeclaration(MethodDefinition(Identifier("assertAcc",SourceSpan(SourcePosition(26,6,608),SourcePosition(26,15,617))),NamedType(Identifier("void",SourceSpan(SourcePosition(26,1,603),SourcePosition(26,5,607))),SourceSpan(SourcePosition(26,1,603),SourcePosition(26,5,607))),List(MemberDefinition(Identifier("fields",SourceSpan(SourcePosition(26,29,631),SourcePosition(26,35,637))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(26,16,618),SourcePosition(26,27,629))),SourceSpan(SourcePosition(26,16,618),SourcePosition(26,27,629))),SourceSpan(SourcePosition(26,16,618),SourcePosition(26,28,630))),SourceSpan(SourcePosition(26,16,618),SourcePosition(26,35,637))), MemberDefinition(Identifier("_id",SourceSpan(SourcePosition(26,41,643),SourcePosition(26,44,646))),NamedType(Identifier("int",SourceSpan(SourcePosition(26,37,639),SourcePosition(26,40,642))),SourceSpan(SourcePosition(26,37,639),SourcePosition(26,40,642))),SourceSpan(SourcePosition(26,37,639),SourcePosition(26,44,646))), MemberDefinition(Identifier("fieldIndex",SourceSpan(SourcePosition(26,50,652),SourcePosition(26,60,662))),NamedType(Identifier("int",SourceSpan(SourcePosition(26,46,648),SourcePosition(26,49,651))),SourceSpan(SourcePosition(26,46,648),SourcePosition(26,49,651))),SourceSpan(SourcePosition(26,46,648),SourcePosition(26,60,662))), MemberDefinition(Identifier("errorMessage",SourceSpan(SourcePosition(26,69,671),SourcePosition(26,81,683))),NamedType(Identifier("string",SourceSpan(SourcePosition(26,62,664),SourcePosition(26,68,670))),SourceSpan(SourcePosition(26,62,664),SourcePosition(26,68,670))),SourceSpan(SourcePosition(26,62,664),SourcePosition(26,81,683)))),None,List(),SourceSpan(SourcePosition(26,1,603),SourcePosition(26,83,685))),VoidType,"assertAcc",List(ResolvedVariable(MemberDefinition(Identifier("fields",SourceSpan(SourcePosition(26,29,631),SourcePosition(26,35,637))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(26,16,618),SourcePosition(26,27,629))),SourceSpan(SourcePosition(26,16,618),SourcePosition(26,27,629))),SourceSpan(SourcePosition(26,16,618),SourcePosition(26,28,630))),SourceSpan(SourcePosition(26,16,618),SourcePosition(26,35,637))),"fields",ResolvedPointer(ResolvedStructType("OwnedFields"))), ResolvedVariable(MemberDefinition(Identifier("_id",SourceSpan(SourcePosition(26,41,643),SourcePosition(26,44,646))),NamedType(Identifier("int",SourceSpan(SourcePosition(26,37,639),SourcePosition(26,40,642))),SourceSpan(SourcePosition(26,37,639),SourcePosition(26,40,642))),SourceSpan(SourcePosition(26,37,639),SourcePosition(26,44,646))),"_id",IntType), ResolvedVariable(MemberDefinition(Identifier("fieldIndex",SourceSpan(SourcePosition(26,50,652),SourcePosition(26,60,662))),NamedType(Identifier("int",SourceSpan(SourcePosition(26,46,648),SourcePosition(26,49,651))),SourceSpan(SourcePosition(26,46,648),SourcePosition(26,49,651))),SourceSpan(SourcePosition(26,46,648),SourcePosition(26,60,662))),"fieldIndex",IntType), ResolvedVariable(MemberDefinition(Identifier("errorMessage",SourceSpan(SourcePosition(26,69,671),SourcePosition(26,81,683))),NamedType(Identifier("string",SourceSpan(SourcePosition(26,62,664),SourcePosition(26,68,670))),SourceSpan(SourcePosition(26,62,664),SourcePosition(26,68,670))),SourceSpan(SourcePosition(26,62,664),SourcePosition(26,81,683))),"errorMessage",StringType)),None,None,false), ResolvedMethodDeclaration(MethodDefinition(Identifier("addAccEnsureSeparate",SourceSpan(SourcePosition(27,6,691),SourcePosition(27,26,711))),NamedType(Identifier("void",SourceSpan(SourcePosition(27,1,686),SourcePosition(27,5,690))),SourceSpan(SourcePosition(27,1,686),SourcePosition(27,5,690))),List(MemberDefinition(Identifier("fields",SourceSpan(SourcePosition(27,40,725),SourcePosition(27,46,731))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(27,27,712),SourcePosition(27,38,723))),SourceSpan(SourcePosition(27,27,712),SourcePosition(27,38,723))),SourceSpan(SourcePosition(27,27,712),SourcePosition(27,39,724))),SourceSpan(SourcePosition(27,27,712),SourcePosition(27,46,731))), MemberDefinition(Identifier("_id",SourceSpan(SourcePosition(27,52,737),SourcePosition(27,55,740))),NamedType(Identifier("int",SourceSpan(SourcePosition(27,48,733),SourcePosition(27,51,736))),SourceSpan(SourcePosition(27,48,733),SourcePosition(27,51,736))),SourceSpan(SourcePosition(27,48,733),SourcePosition(27,55,740))), MemberDefinition(Identifier("fieldIndex",SourceSpan(SourcePosition(27,61,746),SourcePosition(27,71,756))),NamedType(Identifier("int",SourceSpan(SourcePosition(27,57,742),SourcePosition(27,60,745))),SourceSpan(SourcePosition(27,57,742),SourcePosition(27,60,745))),SourceSpan(SourcePosition(27,57,742),SourcePosition(27,71,756))), MemberDefinition(Identifier("numFields",SourceSpan(SourcePosition(27,77,762),SourcePosition(27,86,771))),NamedType(Identifier("int",SourceSpan(SourcePosition(27,73,758),SourcePosition(27,76,761))),SourceSpan(SourcePosition(27,73,758),SourcePosition(27,76,761))),SourceSpan(SourcePosition(27,73,758),SourcePosition(27,86,771))), MemberDefinition(Identifier("errorMessage",SourceSpan(SourcePosition(27,95,780),SourcePosition(27,107,792))),NamedType(Identifier("string",SourceSpan(SourcePosition(27,88,773),SourcePosition(27,94,779))),SourceSpan(SourcePosition(27,88,773),SourcePosition(27,94,779))),SourceSpan(SourcePosition(27,88,773),SourcePosition(27,107,792)))),None,List(),SourceSpan(SourcePosition(27,1,686),SourcePosition(27,109,794))),VoidType,"addAccEnsureSeparate",List(ResolvedVariable(MemberDefinition(Identifier("fields",SourceSpan(SourcePosition(27,40,725),SourcePosition(27,46,731))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(27,27,712),SourcePosition(27,38,723))),SourceSpan(SourcePosition(27,27,712),SourcePosition(27,38,723))),SourceSpan(SourcePosition(27,27,712),SourcePosition(27,39,724))),SourceSpan(SourcePosition(27,27,712),SourcePosition(27,46,731))),"fields",ResolvedPointer(ResolvedStructType("OwnedFields"))), ResolvedVariable(MemberDefinition(Identifier("_id",SourceSpan(SourcePosition(27,52,737),SourcePosition(27,55,740))),NamedType(Identifier("int",SourceSpan(SourcePosition(27,48,733),SourcePosition(27,51,736))),SourceSpan(SourcePosition(27,48,733),SourcePosition(27,51,736))),SourceSpan(SourcePosition(27,48,733),SourcePosition(27,55,740))),"_id",IntType), ResolvedVariable(MemberDefinition(Identifier("fieldIndex",SourceSpan(SourcePosition(27,61,746),SourcePosition(27,71,756))),NamedType(Identifier("int",SourceSpan(SourcePosition(27,57,742),SourcePosition(27,60,745))),SourceSpan(SourcePosition(27,57,742),SourcePosition(27,60,745))),SourceSpan(SourcePosition(27,57,742),SourcePosition(27,71,756))),"fieldIndex",IntType), ResolvedVariable(MemberDefinition(Identifier("numFields",SourceSpan(SourcePosition(27,77,762),SourcePosition(27,86,771))),NamedType(Identifier("int",SourceSpan(SourcePosition(27,73,758),SourcePosition(27,76,761))),SourceSpan(SourcePosition(27,73,758),SourcePosition(27,76,761))),SourceSpan(SourcePosition(27,73,758),SourcePosition(27,86,771))),"numFields",IntType), ResolvedVariable(MemberDefinition(Identifier("errorMessage",SourceSpan(SourcePosition(27,95,780),SourcePosition(27,107,792))),NamedType(Identifier("string",SourceSpan(SourcePosition(27,88,773),SourcePosition(27,94,779))),SourceSpan(SourcePosition(27,88,773),SourcePosition(27,94,779))),SourceSpan(SourcePosition(27,88,773),SourcePosition(27,107,792))),"errorMessage",StringType)),None,None,false), ResolvedMethodDeclaration(MethodDefinition(Identifier("find",SourceSpan(SourcePosition(28,13,807),SourcePosition(28,17,811))),PointerType(NamedType(Identifier("FieldArray",SourceSpan(SourcePosition(28,1,795),SourcePosition(28,11,805))),SourceSpan(SourcePosition(28,1,795),SourcePosition(28,11,805))),SourceSpan(SourcePosition(28,1,795),SourcePosition(28,12,806))),List(MemberDefinition(Identifier("fields",SourceSpan(SourcePosition(28,31,825),SourcePosition(28,37,831))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(28,18,812),SourcePosition(28,29,823))),SourceSpan(SourcePosition(28,18,812),SourcePosition(28,29,823))),SourceSpan(SourcePosition(28,18,812),SourcePosition(28,30,824))),SourceSpan(SourcePosition(28,18,812),SourcePosition(28,37,831))), MemberDefinition(Identifier("_id",SourceSpan(SourcePosition(28,43,837),SourcePosition(28,46,840))),NamedType(Identifier("int",SourceSpan(SourcePosition(28,39,833),SourcePosition(28,42,836))),SourceSpan(SourcePosition(28,39,833),SourcePosition(28,42,836))),SourceSpan(SourcePosition(28,39,833),SourcePosition(28,46,840)))),None,List(),SourceSpan(SourcePosition(28,1,795),SourcePosition(28,48,842))),ResolvedPointer(ResolvedStructType("FieldArray")),"find",List(ResolvedVariable(MemberDefinition(Identifier("fields",SourceSpan(SourcePosition(28,31,825),SourcePosition(28,37,831))),PointerType(NamedType(Identifier("OwnedFields",SourceSpan(SourcePosition(28,18,812),SourcePosition(28,29,823))),SourceSpan(SourcePosition(28,18,812),SourcePosition(28,29,823))),SourceSpan(SourcePosition(28,18,812),SourcePosition(28,30,824))),SourceSpan(SourcePosition(28,18,812),SourcePosition(28,37,831))),"fields",ResolvedPointer(ResolvedStructType("OwnedFields"))), ResolvedVariable(MemberDefinition(Identifier("_id",SourceSpan(SourcePosition(28,43,837),SourcePosition(28,46,840))),NamedType(Identifier("int",SourceSpan(SourcePosition(28,39,833),SourcePosition(28,42,836))),SourceSpan(SourcePosition(28,39,833),SourcePosition(28,42,836))),SourceSpan(SourcePosition(28,39,833),SourcePosition(28,46,840))),"_id",IntType)),None,None,false)),List(),List(),List(),List(ResolvedStructDefinition(StructDefinition(Identifier("OwnedFields",SourceSpan(SourcePosition(1,8,7),SourcePosition(1,19,18))),Some(List(MemberDefinition(Identifier("contents",SourceSpan(SourcePosition(2,26,46),SourcePosition(2,34,54))),ArrayType(PointerType(NamedStructType(Identifier("FieldArray",SourceSpan(SourcePosition(2,12,32),SourcePosition(2,22,42))),SourceSpan(SourcePosition(2,5,25),SourcePosition(2,22,42))),SourceSpan(SourcePosition(2,5,25),SourcePosition(2,23,43))),SourceSpan(SourcePosition(2,5,25),SourcePosition(2,25,45))),SourceSpan(SourcePosition(2,5,25),SourcePosition(2,35,55))), MemberDefinition(Identifier("capacity",SourceSpan(SourcePosition(3,9,64),SourcePosition(3,17,72))),NamedType(Identifier("int",SourceSpan(SourcePosition(3,5,60),SourcePosition(3,8,63))),SourceSpan(SourcePosition(3,5,60),SourcePosition(3,8,63))),SourceSpan(SourcePosition(3,5,60),SourcePosition(3,18,73))), MemberDefinition(Identifier("length",SourceSpan(SourcePosition(4,9,82),SourcePosition(4,15,88))),NamedType(Identifier("int",SourceSpan(SourcePosition(4,5,78),SourcePosition(4,8,81))),SourceSpan(SourcePosition(4,5,78),SourcePosition(4,8,81))),SourceSpan(SourcePosition(4,5,78),SourcePosition(4,16,89))), MemberDefinition(Identifier("instanceCounter",SourceSpan(SourcePosition(5,10,99),SourcePosition(5,25,114))),PointerType(NamedType(Identifier("int",SourceSpan(SourcePosition(5,5,94),SourcePosition(5,8,97))),SourceSpan(SourcePosition(5,5,94),SourcePosition(5,8,97))),SourceSpan(SourcePosition(5,5,94),SourcePosition(5,9,98))),SourceSpan(SourcePosition(5,5,94),SourcePosition(5,26,115))))),SourceSpan(SourcePosition(1,1,0),SourcePosition(7,3,119))),"OwnedFields",List(ResolvedStructField(MemberDefinition(Identifier("contents",SourceSpan(SourcePosition(2,26,46),SourcePosition(2,34,54))),ArrayType(PointerType(NamedStructType(Identifier("FieldArray",SourceSpan(SourcePosition(2,12,32),SourcePosition(2,22,42))),SourceSpan(SourcePosition(2,5,25),SourcePosition(2,22,42))),SourceSpan(SourcePosition(2,5,25),SourcePosition(2,23,43))),SourceSpan(SourcePosition(2,5,25),SourcePosition(2,25,45))),SourceSpan(SourcePosition(2,5,25),SourcePosition(2,35,55))),"contents","OwnedFields",ResolvedArray(ResolvedPointer(ResolvedStructType("FieldArray")))), ResolvedStructField(MemberDefinition(Identifier("capacity",SourceSpan(SourcePosition(3,9,64),SourcePosition(3,17,72))),NamedType(Identifier("int",SourceSpan(SourcePosition(3,5,60),SourcePosition(3,8,63))),SourceSpan(SourcePosition(3,5,60),SourcePosition(3,8,63))),SourceSpan(SourcePosition(3,5,60),SourcePosition(3,18,73))),"capacity","OwnedFields",IntType), ResolvedStructField(MemberDefinition(Identifier("length",SourceSpan(SourcePosition(4,9,82),SourcePosition(4,15,88))),NamedType(Identifier("int",SourceSpan(SourcePosition(4,5,78),SourcePosition(4,8,81))),SourceSpan(SourcePosition(4,5,78),SourcePosition(4,8,81))),SourceSpan(SourcePosition(4,5,78),SourcePosition(4,16,89))),"length","OwnedFields",IntType), ResolvedStructField(MemberDefinition(Identifier("instanceCounter",SourceSpan(SourcePosition(5,10,99),SourcePosition(5,25,114))),PointerType(NamedType(Identifier("int",SourceSpan(SourcePosition(5,5,94),SourcePosition(5,8,97))),SourceSpan(SourcePosition(5,5,94),SourcePosition(5,8,97))),SourceSpan(SourcePosition(5,5,94),SourcePosition(5,9,98))),SourceSpan(SourcePosition(5,5,94),SourcePosition(5,26,115))),"instanceCounter","OwnedFields",ResolvedPointer(IntType)))), ResolvedStructDefinition(StructDefinition(Identifier("FieldArray",SourceSpan(SourcePosition(11,8,169),SourcePosition(11,18,179))),Some(List(MemberDefinition(Identifier("contents",SourceSpan(SourcePosition(12,10,191),SourcePosition(12,18,199))),ArrayType(NamedType(Identifier("bool",SourceSpan(SourcePosition(12,3,184),SourcePosition(12,7,188))),SourceSpan(SourcePosition(12,3,184),SourcePosition(12,7,188))),SourceSpan(SourcePosition(12,3,184),SourcePosition(12,9,190))),SourceSpan(SourcePosition(12,3,184),SourcePosition(12,19,200))), MemberDefinition(Identifier("length",SourceSpan(SourcePosition(13,7,207),SourcePosition(13,13,213))),NamedType(Identifier("int",SourceSpan(SourcePosition(13,3,203),SourcePosition(13,6,206))),SourceSpan(SourcePosition(13,3,203),SourcePosition(13,6,206))),SourceSpan(SourcePosition(13,3,203),SourcePosition(13,14,214))), MemberDefinition(Identifier("_id",SourceSpan(SourcePosition(14,7,221),SourcePosition(14,10,224))),NamedType(Identifier("int",SourceSpan(SourcePosition(14,3,217),SourcePosition(14,6,220))),SourceSpan(SourcePosition(14,3,217),SourcePosition(14,6,220))),SourceSpan(SourcePosition(14,3,217),SourcePosition(14,11,225))), MemberDefinition(Identifier("numAccessible",SourceSpan(SourcePosition(15,7,232),SourcePosition(15,20,245))),NamedType(Identifier("int",SourceSpan(SourcePosition(15,3,228),SourcePosition(15,6,231))),SourceSpan(SourcePosition(15,3,228),SourcePosition(15,6,231))),SourceSpan(SourcePosition(15,3,228),SourcePosition(15,21,246))), MemberDefinition(Identifier("deleted",SourceSpan(SourcePosition(16,8,254),SourcePosition(16,15,261))),NamedType(Identifier("bool",SourceSpan(SourcePosition(16,3,249),SourcePosition(16,7,253))),SourceSpan(SourcePosition(16,3,249),SourcePosition(16,7,253))),SourceSpan(SourcePosition(16,3,249),SourcePosition(16,16,262))))),SourceSpan(SourcePosition(11,1,162),SourcePosition(17,3,265))),"FieldArray",List(ResolvedStructField(MemberDefinition(Identifier("contents",SourceSpan(SourcePosition(12,10,191),SourcePosition(12,18,199))),ArrayType(NamedType(Identifier("bool",SourceSpan(SourcePosition(12,3,184),SourcePosition(12,7,188))),SourceSpan(SourcePosition(12,3,184),SourcePosition(12,7,188))),SourceSpan(SourcePosition(12,3,184),SourcePosition(12,9,190))),SourceSpan(SourcePosition(12,3,184),SourcePosition(12,19,200))),"contents","FieldArray",ResolvedArray(BoolType)), ResolvedStructField(MemberDefinition(Identifier("length",SourceSpan(SourcePosition(13,7,207),SourcePosition(13,13,213))),NamedType(Identifier("int",SourceSpan(SourcePosition(13,3,203),SourcePosition(13,6,206))),SourceSpan(SourcePosition(13,3,203),SourcePosition(13,6,206))),SourceSpan(SourcePosition(13,3,203),SourcePosition(13,14,214))),"length","FieldArray",IntType), ResolvedStructField(MemberDefinition(Identifier("_id",SourceSpan(SourcePosition(14,7,221),SourcePosition(14,10,224))),NamedType(Identifier("int",SourceSpan(SourcePosition(14,3,217),SourcePosition(14,6,220))),SourceSpan(SourcePosition(14,3,217),SourcePosition(14,6,220))),SourceSpan(SourcePosition(14,3,217),SourcePosition(14,11,225))),"_id","FieldArray",IntType), ResolvedStructField(MemberDefinition(Identifier("numAccessible",SourceSpan(SourcePosition(15,7,232),SourcePosition(15,20,245))),NamedType(Identifier("int",SourceSpan(SourcePosition(15,3,228),SourcePosition(15,6,231))),SourceSpan(SourcePosition(15,3,228),SourcePosition(15,6,231))),SourceSpan(SourcePosition(15,3,228),SourcePosition(15,21,246))),"numAccessible","FieldArray",IntType), ResolvedStructField(MemberDefinition(Identifier("deleted",SourceSpan(SourcePosition(16,8,254),SourcePosition(16,15,261))),NamedType(Identifier("bool",SourceSpan(SourcePosition(16,3,249),SourcePosition(16,7,253))),SourceSpan(SourcePosition(16,3,249),SourcePosition(16,7,253))),SourceSpan(SourcePosition(16,3,249),SourcePosition(16,16,262))),"deleted","FieldArray",BoolType)))),List(ResolvedTypeDef(TypeDefinition(Identifier("OwnedFields",SourceSpan(SourcePosition(9,28,148),SourcePosition(9,39,159))),NamedStructType(Identifier("OwnedFields",SourceSpan(SourcePosition(9,16,136),SourcePosition(9,27,147))),SourceSpan(SourcePosition(9,9,129),SourcePosition(9,27,147))),SourceSpan(SourcePosition(9,1,121),SourcePosition(9,40,160))),"OwnedFields",ResolvedStructType("OwnedFields")), ResolvedTypeDef(TypeDefinition(Identifier("FieldArray",SourceSpan(SourcePosition(19,27,293),SourcePosition(19,37,303))),NamedStructType(Identifier("FieldArray",SourceSpan(SourcePosition(19,16,282),SourcePosition(19,26,292))),SourceSpan(SourcePosition(19,9,275),SourcePosition(19,26,292))),SourceSpan(SourcePosition(19,1,267),SourcePosition(19,38,304))),"FieldArray",ResolvedStructType("FieldArray"))),List())


    //val runtimeSource = Source.fromResource(name + ".h0").mkString
    // val parsed = Parser.parseProgram(runtimeSource) match {
    //   case _: Failure =>
    //     throw new WeaverException("Cannot parse runtime header")
    //   case Success(value, _) => value
    // }

    // val errors = new ErrorSink()
    // val resolved = Resolver.resolveProgram(parsed, List(), errors)
    // if (errors.errors.nonEmpty)
    //   throw new WeaverException("Cannot resolve runtime header")

    resolved
  }

  def addToIR(program: IR.Program): CheckRuntime = {
    val dependency = program.addDependency(name, isLibrary = true)
    DependencyTransformer.transform(program, dependency, header)
    new CheckRuntime(program)
  }

  object Names {
    val ownedFieldsStruct = "OwnedFields"
    val fieldArray = "FieldArray"
    val primaryOwnedFields = "_ownedFields"
    val temporaryOwnedFields = "_tempFields"
    val contextOwnedFields = "_contextFields"
    val initOwnedFields = "initOwnedFields"
    val addStructAcc = "addStructAcc"
    val addAcc = "addAcc"
    val loseAcc = "loseAcc"
    val join = "join"
    val assertAcc = "assertAcc"
    val addAccEnsureSeparate = "addAccEnsureSeparate"
    val find = "find"
    val instanceCounter = "_instanceCounter"
    val id = "_id"
    val removePrefix = "remove_"
    val addPrefix = "add_"
    val checkPrefix = "check_"
  }
}

class CheckRuntime private (program: IR.Program) {
  import CheckRuntime.Names
  val ownedFields: IR.StructDefinition =
    program.struct(Names.ownedFieldsStruct)
  val ownedFieldsRef = new IR.ReferenceType(ownedFields)
  val ownedFieldInstanceCounter: Option[IR.StructField] =
    ownedFields.fields.find(_.name == "instanceCounter")
  val initOwnedFields: IR.MethodDefinition =
    program.method(Names.initOwnedFields)
  val addStructAcc: IR.MethodDefinition =
    program.method(Names.addStructAcc)
  val addAcc: IR.MethodDefinition = program.method(Names.addAcc)
  val addAccEnsureSeparate: IR.MethodDefinition =
    program.method(Names.addAccEnsureSeparate)
  val loseAcc: IR.MethodDefinition = program.method(Names.loseAcc)
  val join: IR.MethodDefinition = program.method(Names.join)
  val assertAcc: IR.MethodDefinition = program.method(Names.assertAcc)
  val find: IR.MethodDefinition = program.method(Names.find)
}
